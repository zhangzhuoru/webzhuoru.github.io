"use strict";(self["webpackChunkpacket"]=self["webpackChunkpacket"]||[]).push([[435],{321:function(e,t,s){s.d(t,{A:function(){return u}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"level-nav card"},[t("div",{staticClass:"level-nav__header"},[t("h3",{staticClass:"section-title"},[e._v("关卡选择")]),e.levels.length?t("p",{staticClass:"level-nav__meta"},[e._v(" 已解锁 "+e._s(e.unlockedLevels.length)+"/"+e._s(e.levels.length)+" ")]):e._e()]),e.levels.length?t("div",{staticClass:"level-grid"},e._l(e.levels,function(s){return t("button",{key:s.id,staticClass:"level-cell",class:{active:s.id===e.currentLevelId,locked:!e.isUnlocked(s.id)},attrs:{type:"button"},on:{click:function(t){return e.handleSelect(s)}}},[t("div",{staticClass:"level-cell__head"},[t("span",{staticClass:"level-cell__title"},[e._v(e._s(s.title))]),t("van-icon",{attrs:{name:e.isUnlocked(s.id)?"success":"lock",color:e.isUnlocked(s.id)?"#10b981":"#f97316"}})],1),t("p",{staticClass:"level-cell__range"},[e._v(" 题目 "+e._s(s.start+1)+" - "+e._s(s.end)+" ")]),t("p",{staticClass:"level-cell__status"},[e._v(" "+e._s(e.isUnlocked(s.id)?"点击开始":"完成前一关解锁")+" ")])])}),0):t("van-empty",{attrs:{description:"请先导入题库"}})],1)},l=[],n={name:"LevelNavigator",props:{levels:{type:Array,default:()=>[]},currentLevelId:{type:String,default:""},unlockedLevels:{type:Array,default:()=>[]}},methods:{isUnlocked(e){return this.unlockedLevels.length?this.unlockedLevels.includes(e):e===this.levels[0]?.id},handleSelect(e){this.isUnlocked(e.id)?this.$emit("select",e):this.$toast("先完成前一关卡即可解锁")}}},a=n,r=s(656),o=(0,r.A)(a,i,l,!1,null,"4964e19e",null),u=o.exports},435:function(e,t,s){s.r(t),s.d(t,{default:function(){return g}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"quiz-page"},[e.hasBank?[t("section",{staticClass:"card level-summary"},[t("div",[t("p",{staticClass:"level-summary__label"},[e._v("当前关卡")]),t("p",{staticClass:"level-summary__title"},[e._v(e._s(e.currentLevel?.title||"未选择"))]),e.currentLevel?t("p",{staticClass:"level-summary__desc"},[e._v(" 题目 "+e._s(e.currentLevel.start+1)+" - "+e._s(e.currentLevel.end)+" ")]):e._e()]),t("van-button",{attrs:{size:"small",plain:"",type:"primary"},on:{click:e.openLevelPicker}},[e._v(" 切换关卡 ")])],1),e.currentQuestion?t("section",{staticClass:"card quiz-panel"},[t("div",{staticClass:"quiz-panel__header"},[t("div",[t("p",{staticClass:"level-title"},[e._v(e._s(e.currentLevel?.title))]),t("p",{staticClass:"progress-text"},[e._v(" 第 "+e._s(e.questionProgress.current)+"/"+e._s(e.questionProgress.total)+" 题 ")])])]),t("question-card",{attrs:{question:e.currentQuestion,value:e.answerValue,disabled:e.currentQuestion.isAnswered,"show-result":e.showExplanation},on:{input:e.updateAnswer}}),t("div",{staticClass:"quiz-actions"},[t("van-button",{attrs:{type:"default",size:"small",disabled:1===e.questionProgress.current},on:{click:e.handlePrev}},[e._v(" 上一题 ")]),t("van-button",{attrs:{type:"primary",size:"small",loading:e.submitting},on:{click:e.handleSubmit}},[e._v(" "+e._s(e.currentQuestion.isAnswered?"重选答案":"提交答案")+" ")]),t("van-button",{attrs:{type:"info",size:"small",disabled:!e.currentQuestion.isAnswered||e.showAnswerManually,plain:""},on:{click:e.handleReveal}},[e._v(" 查看解析 ")])],1),e.questionProgress.current==e.questionProgress.total&&e.canFinish?t("van-button",{staticClass:"mt-12",attrs:{block:"",type:"success"},on:{click:e.handleFinish}},[e._v(" 查看本关结果 ")]):t("van-button",{staticClass:"mt-12",attrs:{block:"",type:"success"},on:{click:e.handleNext}},[e._v(" 下一题 ")])],1):e._e()]:t("section",{staticClass:"empty card"},[t("van-empty",{attrs:{image:"folder",description:"请先导入题库"}},[t("van-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.$router.push("/import")}}},[e._v(" 去导入 ")])],1)],1),t("van-popup",{style:{height:"70vh"},attrs:{position:"bottom",round:""},model:{value:e.levelPickerVisible,callback:function(t){e.levelPickerVisible=t},expression:"levelPickerVisible"}},[t("div",{staticClass:"level-popup"},[t("div",{staticClass:"level-popup__header"},[t("h3",[e._v("选择关卡")]),t("van-icon",{attrs:{name:"cross"},on:{click:e.closeLevelPicker}})],1),t("level-navigator",{attrs:{levels:e.levels,"current-level-id":e.currentLevelId,"unlocked-levels":e.unlockedLevels},on:{select:e.handleSelectLevel}})],1)])],2)},l=[],n=s(353),a=s(321),r=function(){var e=this,t=e._self._c;return e.question?t("div",{staticClass:"question-card card"},[t("div",{staticClass:"question-card__header"},[t("div",{staticClass:"question-card__meta"},[t("van-tag",{attrs:{type:e.typeTag,round:"",plain:""}},[e._v(e._s(e.typeLabel))]),t("span",{staticClass:"question-card__badge"},[e._v("ID："+e._s(e.displayId))])],1),t("p",{staticClass:"question-card__title"},[e._v(" "+e._s(e.question.question)+" ")])]),t("div",{staticClass:"question-card__body"},[e.isSingleType?t("van-radio-group",{staticClass:"option-group",attrs:{value:e.value,disabled:e.disabled},on:{input:e.handleChange}},e._l(e.question.options,function(s){return t("van-radio",{key:s.key,staticClass:"option-item",attrs:{name:s.key,"icon-size":"18"}},[t("span",{staticClass:"option-key"},[e._v(e._s(s.key)+".")]),t("span",{staticClass:"option-label"},[e._v(e._s(s.label))])])}),1):t("van-checkbox-group",{staticClass:"option-group",attrs:{value:e.value,disabled:e.disabled},on:{input:e.handleChange}},e._l(e.question.options,function(s){return t("van-checkbox",{key:s.key,staticClass:"option-item",attrs:{name:s.key,"icon-size":"18"}},[t("span",{staticClass:"option-key"},[e._v(e._s(s.key)+".")]),t("span",{staticClass:"option-label"},[e._v(e._s(s.label))])])}),1)],1),e.showResult?t("div",{staticClass:"question-card__result"},[t("div",{staticClass:"result-pill",class:{success:e.question.isCorrect}},[e._v(" "+e._s(e.question.isCorrect?"回答正确":"回答错误")+" ")]),t("p",{staticClass:"correct-answer"},[e._v(" 正确答案："+e._s(e.formattedCorrectAnswer)+" ")]),e.question.explanation?t("p",{staticClass:"explanation"},[e._v(" 解析："+e._s(e.question.explanation)+" ")]):e._e()]):e._e()]):e._e()},o=[],u=s(869),c={name:"QuestionCard",props:{question:{type:Object,required:!0},value:{type:[String,Array,null],default:null},disabled:{type:Boolean,default:!1},showResult:{type:Boolean,default:!1}},computed:{isSingleType(){return"single"===this.question.type||"judge"===this.question.type},typeLabel(){return"multiple"===this.question.type?"多选":"judge"===this.question.type?"判断":"单选"},typeTag(){return"multiple"===this.question.type?"warning":"judge"===this.question.type?"default":"primary"},formattedCorrectAnswer(){return Array.isArray(this.question.correctAnswer)?(0,u.aS)(this.question.correctAnswer):this.question.correctAnswer},displayId(){return this.question.id||this.question.I||"未编号"}},methods:{handleChange(e){this.$emit("input",e),this.$emit("update:value",e)}}},d=c,h=s(656),v=(0,h.A)(d,r,o,!1,null,"72aa671b",null),p=v.exports,_={name:"QuizPage",components:{LevelNavigator:a.A,QuestionCard:p},data(){return{answerValue:null,submitting:!1,showAnswerManually:!1,levelPickerVisible:!1,autoNextTimer:null}},computed:{...(0,n.L8)("questions",["currentQuestion","questionProgress","levels"]),...(0,n.L8)("questions",{hasBank:"hasBank"}),...(0,n.aH)("questions",["currentLevelId","currentQuestions","questionBank"]),...(0,n.L8)("progress",["unlockedLevels"]),...(0,n.aH)("user",["autoShowExplanation"]),currentLevel(){return this.levels.find(e=>e.id===this.currentLevelId)||null},progressPercent(){return this.questionProgress.total?Math.round(this.questionProgress.current/this.questionProgress.total*100):0},showExplanation(){return!!this.currentQuestion?.isAnswered&&(this.autoShowExplanation||this.showAnswerManually)},canFinish(){return this.questionProgress.total>0&&this.currentQuestions.every(e=>e.isAnswered)}},watch:{currentQuestion:{immediate:!0,handler(e){console.log("question123",e),e?(this.showAnswerManually=!1,"multiple"===e.type?this.answerValue=e.userAnswer?[...e.userAnswer]:[]:this.answerValue=e.userAnswer||null):this.answerValue=null}},levels:{immediate:!0,handler(){this.bootstrapLevel()}}},mounted(){this.bootstrapLevel(),console.log("currentQuestion",this.currentQuestion)},beforeDestroy(){this.autoNextTimer&&clearTimeout(this.autoNextTimer)},methods:{...(0,n.i0)("questions",["loadLevelQuestions","submitAnswer","goNext","goPrev","finishLevel"]),updateAnswer(e){this.answerValue=e},openLevelPicker(){this.levelPickerVisible=!0},closeLevelPicker(){this.levelPickerVisible=!1},handleSelectLevel(e){this.loadLevelQuestions(e.id),this.closeLevelPicker()},handlePrev(){this.goPrev()},async handleSubmit(){if(this.currentQuestion)if("multiple"!==this.currentQuestion.type||this.answerValue?.length)if("multiple"===this.currentQuestion.type||this.answerValue){this.submitting=!0;try{const e="multiple"===this.currentQuestion.type?[...this.answerValue].sort():this.answerValue,t=await this.submitAnswer(e);this.$toast(t?"回答正确":"再想想"),t||("multiple"===this.currentQuestion.type?this.answerValue=[]:this.answerValue=null,this.currentQuestion.isAnswered=!1),this.autoShowExplanation,t&&this.scheduleAutoNext()}catch(e){this.$toast.fail("提交失败")}finally{this.submitting=!1}}else this.$toast("请选择一个答案");else this.$toast("请选择至少一个选项")},handleReveal(){this.showAnswerManually=!0},async handleFinish(){this.canFinish?(await this.finishLevel(),this.$router.push({name:"Result"})):this.$toast("请完成本关所有题目后再查看结果")},handleNext(){this.goNext()},bootstrapLevel(){if(!this.hasBank||!this.levels.length)return;if(this.currentQuestions.length)return;const e=this.currentLevelId||this.levels[0].id;e&&this.loadLevelQuestions(e)},scheduleAutoNext(){this.autoNextTimer&&(clearTimeout(this.autoNextTimer),this.autoNextTimer=null);const e=this.questionProgress.current>=this.questionProgress.total;e||(this.autoNextTimer=setTimeout(()=>{this.goNext(),this.autoNextTimer=null},800))}}},m=_,y=(0,h.A)(m,i,l,!1,null,"8dbe3f34",null),g=y.exports}}]);
//# sourceMappingURL=435.ac926b24.js.map